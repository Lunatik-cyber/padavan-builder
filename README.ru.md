<p align="right"><a href="README.md">English</a> | Русский</p>

## Padavan builder

Автоматизированный сборщик прошивки Padavan. Работает на Debian или Ubuntu, в том числе в подсистеме Windows для Linux (WSL).

### Использование

```sh
wget -qO- https://github.com/shvchk/padavan-builder/raw/main/host.sh | bash
```

Рекомендую проверить скрипт [host.sh](host.sh) перед запуском. Это хорошая практика перед запуском любого кода на вашем компьютере, особенно удалённого кода.

Скрипт сделает следующее (шаги, требующие ручного вмешательства, выделены жирным, всё остальное автоматизировано):

- Создаст заготовку контейнера [Podman](https://podman.io) (образ) со всеми необходимыми зависимостями

- Скачает исходные коды Padavan

- Соберёт тулчейн

- **Предложит выбрать модель роутера**

  Список моделей можно фильтровать вводом текста. Используйте стрелки `↑` `↓` для выбора модели, нажмите `Enter` для подтверждения.

- **Откроет файл настройки сборки в текстовом редакторе** ([micro](https://micro-editor.github.io))

  Отредактируйте файл на ваше усмотрение: раскомментируйте (удалите `#` в начале строки) функции, которые вам нужны, закомментируйте те, которые не нужны. Сохраните (`Ctrl + S`) и закройте (`Ctrl + Q`) файл, когда закончите.

  В редакторе полноценно работает мышь, буфер обмена и привычные методы редактирования и навигации: `Ctrl + C`, `Ctrl + V`, `Ctrl + X`, `Ctrl + Z`, `Ctrl + F` и т.п.

- Соберёт прошивку

- Поместит готовую прошивку (`trx` файл) в домашнюю папку (Linux) или в `C:/Users/Public/Downloads/padavan` (WSL)


### Повторное использование / пересборка

Скрипт не удаляет Podman-образ с собранным тулчейном после сборки прошивки, чтобы его можно было переиспользовать.

Чтобы пересобрать прошивку, выполните:

```sh
podman run --rm --ulimit nofile=9000 -it -v "$HOME":/tmp/trx padavan bash /opt/container.sh
```

Процесс начнётся с выбора модели роутера. Собранный `trx` файл будет помещён в домашнюю папку в Linux системе. Если вы используете WSL, вы можете переместить `trx` в `C:/Users/Public/Downloads/padavan`:

```sh
mv "$HOME"/*trx /mnt/c/Users/Public/Downloads/padavan
```


### Очистка / удаление

Чтобы всё удалить, выполните:

```sh
podman system reset -f
```

Останется только сам пакет `podman`, а все данные будут удалены.


### Использование другого репозитория или ветки

По умолчанию скрипт использует репозиторий [gitlab.com/hadzhioglu/padavan-ng](https://gitlab.com/hadzhioglu/padavan-ng) и `master` ветку. Чтобы использовать другой репозиторий и ветку, можно передать их скрипту как параметр: `host.sh <ссылка_на_репозиторий> <ветка>`. При запуске через пайп, как мы изначально и делали, параметры можно передать так:

```sh
wget -qO- https://github.com/shvchk/padavan-builder/raw/main/host.sh | \
bash -s -- https://example.com/anonymous/padavan dev
```

В примере выше мы используем репозиторий `https://example.com/anonymous/padavan` и ветку `dev`.

Репозиторий должен содержать `Dockerfile`.
